/**
 * This is template for main module created by New Kinetis SDK 2.x Project Wizard. Enjoy!
 **/

#include "board.h"
#include "pin_mux.h"
#include "clock_config.h"
#include "fsl_ftm.h"

/*******************************************************************************
 * Definitions
 ******************************************************************************/
/* The Flextimer instance/channel used for board */

/* Get source clock for FTM driver */
#define FTM_SOURCE_CLOCK CLOCK_GetFreq(kCLOCK_CoreSysClk)

int main(void) {
  /* Board pin, clock, debug console init */
  BOARD_InitPins();
  BOARD_BootClockRUN();
  BOARD_InitDebugConsole();

  /* Add your code here */
  int i;
  ftm_config_t ftmInfo;
  ftm_chnl_pwm_signal_param_t ftmParam;

  FTM_GetDefaultConfig(&ftmInfo);
//  ftmInfo.chnlPolarity=1U;
  FTM_Init(FTM0, &ftmInfo);
  FTM_Init(FTM1, &ftmInfo);
  FTM_Init(FTM2, &ftmInfo);
  FTM_Init(FTM4, &ftmInfo);

  ftmParam.level = 1U;
  ftmParam.dutyCyclePercent = 1U;
  ftmParam.firstEdgeDelayPercent = 0U;
  ftmParam.chnlNumber = PWM_CHANNELS[0];

  ftm_chnl_pwm_signal_param_t ftmParams[6]={ftmParam,ftmParam,ftmParam,ftmParam,ftmParam,ftmParam};

  for (i=0;i<6;i++)
  {
	  ftmParams[i].chnlNumber=i;
	  FTM_UpdateChnlEdgeLevelSelect(FTM0, i, kFTM_HighTrue); //Should be able to do this during FTM initialization
	  FTM0->CONTROLS[i].CnV = 5;
  }

  FTM_SetupPwm(FTM0, &ftmParams, 6U, kFTM_EdgeAlignedPwm, 2400U, FTM_SOURCE_CLOCK);

  FTM_StartTimer(FTM0, kFTM_SystemClock);
//  for (i=0;i<6;i++)
//  {
//	  FTM_UpdateChnlEdgeLevelSelect(FTM0, i, kFTM_HighTrue); //Should be able to do this during FTM initialization
//	  FTM0->CONTROLS[i].CnV = 5;
//  }
  FTM_SetSoftwareTrigger(FTM0, true);

  while (1)
  {
      __asm("NOP"); /* something to use as a breakpoint stop while looping */
  }
}
